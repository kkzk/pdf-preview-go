# PDF Preview Go - アプリケーション仕様書

## 概要
PDF Preview Go は、ExcelファイルをPDFに変換してプレビューするデスクトップアプリケーションです。
Go（Wails）をバックエンド、Svelte/Viteをフロントエンドとして使用しています。

## 基本機能

### 1. ファイル管理
- **ディレクトリツリー表示**: 作業フォルダ内のファイル・フォルダをツリー表示
- **ファイル選択**: Excelファイル（.xls, .xlsx）の複数選択
- **ファイル並び替え**: 選択ファイルの順序変更（上下移動）
- **ファイル削除**: 選択リストからのファイル削除

### 2. PDF変換・プレビュー
- **シート選択**: Excelファイルの個別シート選択
- **PDF変換**: 選択シートのPDF変換
- **リアルタイムプレビュー**: PDF表示エリアでのプレビュー
- **自動更新**: ファイル変更時の自動PDF再生成

### 3. ファイル保存
- **PDF保存**: 生成されたPDFファイルの任意場所への保存
- **保存状態管理**: 未保存変更の追跡
- **デフォルトパス**: 前回保存場所の記憶

## ユーザーインタフェース仕様

### レイアウト構成
- **左パネル**: ファイルツリー、選択ファイル、シート選択
- **右パネル**: PDFプレビュー、ログ表示
- **リサイザー**: パネル間のサイズ調整

### クリック操作
- **ファイル/フォルダ行**: 行全体がクリック可能領域
- **フォルダ**: クリックで展開/折りたたみ
- **ファイル**: クリックで選択/選択解除
- **選択ファイル**: クリックでアクティブファイル切り替え

### レスポンシブ表示
- **PDF表示領域**: 他コンポーネント使用分以外の全領域を使用
- **ログパネル**: 展開時は固定高さ、折りたたみ時は最小高さ
- **動的高さ調整**: コンテンツに応じた自動サイズ調整

## アプリケーション終了時の動作仕様

### 終了確認プロセス
1. **保存状態チェック**: 未保存のPDF変更があるかを確認
2. **確認ダイアログ表示**: 未保存変更がある場合のみ

### ダイアログ選択肢と動作
| 選択 | 動作 | 結果 |
|------|------|------|
| **OK** | PDF保存ダイアログを表示 | 保存成功後にアプリケーション終了 |
| **キャンセル** | 保存せずに終了 | 即座にアプリケーション終了 |
| **× (閉じる)** | 終了をキャンセル | アプリケーションは継続動作 |

### エラーハンドリング
- **保存エラー**: 保存に失敗した場合、アプリケーションは終了しない
- **処理エラー**: 終了処理でエラーが発生した場合、ログに記録

## 自動機能

### ファイル監視
- **変更検出**: 選択ファイルの更新を監視
- **自動再変換**: ファイル変更時の自動PDF再生成
- **プログレス表示**: 変換状況のリアルタイム表示

### 設定保持
- **自動更新設定**: アプリケーション再起動時の設定保持
- **パネルサイズ**: UI レイアウト設定の保持
- **作業ディレクトリ**: 最後に使用したフォルダの記憶

## エラー処理

### ログ機能
- **操作ログ**: ユーザー操作の記録
- **エラーログ**: システムエラーの詳細記録
- **進行状況**: 変換・保存処理の状況表示

### エラー種別
- **ファイルアクセスエラー**: 読み取り/書き込み権限不足
- **変換エラー**: Excel→PDF変換失敗
- **保存エラー**: ファイル保存失敗
- **システムエラー**: 予期しないエラー

## 開発・保守仕様

### アーキテクチャ
- **バックエンド**: Go + Wails v2.10.2
- **フロントエンド**: Svelte + Vite
- **コンポーネント構成**: 機能別モジュラー設計

### ビルド・実行
- **開発**: `wails dev` (ホットリロード)
- **本番ビルド**: `wails build`
- **テスト実行**: `.\build\bin\pdf-preview-go.exe .\test`

### コード品質
- **自動フォーマット**: 保存時の自動コード整形
- **エラーチェック**: TypeScript/Go言語の型検証
- **継続的品質管理**: ビルド時の警告・エラー0を維持

---

## 更新履歴
- 2025/08/09: アプリケーション終了時確認機能を追加
- 2025/08/09: クリック範囲拡大（行全体クリック対応）
- 2025/08/09: コンポーネント分割による保守性向上
- 2025/08/09: レイアウト調整（PDF表示領域最大化）

## 関連ドキュメント
- `README.md`: セットアップ・使用方法
- `.github/copilot-instructions.md`: 開発者向け指針
- `wails.json`: ビルド設定
- `build/`: OS固有のビルド・インストーラ設定
